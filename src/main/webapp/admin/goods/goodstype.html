<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>拍拍网商品类型管理</title>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
</head>
<body>
	<h3>商品类型管理</h3>
	<button id="add">增加类型</button>
	<form id="form" method="post" enctype="multipart/form-data">
		<table id="addtab" hidden="true">
			<tr>
				<td>类型名</td>
				<td>图片</td>
				<td>类型描述</td>
				<td>操作</td>
			</tr>
			<tr>
				<td><input name="gtname" /></td>
				<td><input id="file" name="file" type="file" multiple="multiple"/></td>
				<td><input name="gtdes"/></td>
				<td><input id="upload" name="upload" type="button" value="上传"></td>
			</tr>
		</table>
	</form>
	<table  border="1px">
		<h4>商品类型表</h4>
		<thead>
			<tr>
				<td>类型id</td>
				<td>类型名</td>
				<td>图片</td>
				<td>类型描述</td>
				<td>操作</td>
			</tr>
		</thead>
		<tbody id="goodstype">		
		</tbody>
	</table>
</body>
<script type="text/javascript">
	//获取所有商品类型
	$(function(){
		function find(){
			$.ajax({
				type:"get",
				url:"/goodsType",
				success:function(data){
					$("#goodstype").empty();
					for(var i=0;i<data.length;i++){
						var tr=$("<tr></tr>");
						
						var td1=$("<td></td>");
						var td2=$("<td></td>");
						var td3=$("<td></td>");
						var td4=$("<td></td>");
						var td5=$("<td></td>");
						
						td1.html(data[i].gtid);
						td2.html(data[i].gtname);
						td3.html( "<img width='100px' src='goodsTypeImg/"+data[i].img+"'>  "  );
						td4.html(data[i].gtdes);
					    td5 = $("<td>");
						//删除选中的数据
						var del = $("<button>删除</button>");
						del.click(function(){
							
								var id = $(this).parent().parent().children().eq(0).html();
	
								$.ajax({
										type:"delete",
										url:"/goodsType",
										data:{"gtid":id},
										success:function(){
											find();
											alert("删除成功");											
										}
									
									});
							});

						//修改收数据
						var upd = $("<button>修改</button>");
						upd.click(function(){
							
							if($(this).html()=="确认修改"){
								var tr = $(this).parent().parent().children().eq(0).html();
								$.ajax({
									type:"put",
									url:"/goodsType",
									data:{
										"gtid":tr,
										"gtname":$("#gtname").val(),
										"img":$("#img").val(),
										"gtdes":$("#gtdes").val()
									},
									//请求成功后刷新页面显示数据
									success:function(){
										find();
									}
									
								});
								
							}else{
								
							
							//获取要修改的所有数据对象
							var ogtname = $(this).parent().parent().children().eq(1);
							var oimg = $(this).parent().parent().children().eq(2);
							var ogtdes = $(this).parent().parent().children().eq(3);
						
							//取出jquery对象中的数据
							var gtname = ogtname.html();
							var img	   = oimg.html();
							var gtdes  = ogtdes.html();
						
							//将数据重新填充进表格，数据回显
							ogtname.replaceWith("<td><input id='gtname' name='gtname' value="+gtname+ " ></td>");
							//img.replaceWith("<td><input id='img' name='img' value="+img+ " ></td>");
							ogtdes.replaceWith("<td><input id='gtdes' name='gtdes' value="+gtdes+ " ></td>");
							
							
							$(this).html("确认修改");
							
							}
							
						});
						
						td5.append(del);
						td5.append(upd);
						tr.append(td1);
						tr.append(td2);
						tr.append(td3);
						tr.append(td4);
						tr.append(td5);
						
						$("#goodstype").append(tr);
					}							
				}
			});
		}
		
		find();
		//显示增加表单
		$("#add").click(function(){	
			$("#addtab").toggle();
		});
		//添加商品类型
		$("#addbtn").click(function(){
			var params=$("form").serialize();
			$.ajax({
				type:"post",
				url:"/goodsType",
				data:params,
				success:function(){
					find();
				}
			});		
		});
		//添加拍品
        $("#upload").click(function () {
    
        	var params=$("form").serialize();//获取表单中的拍品id
           var formData = new FormData($('#form')[0]);//获取表单中的文件
           //ajax请求
           $.ajax({
               url:"/goodsType",//后台的接口地址
               type:"post",//post请求方式
               data:formData,params,//参数
               cache: false,
               processData: false,
               contentType: false,
               success:function (data) {
                   alert(data);
                   find();
               },error:function () {
                   alert("操作失败~");
               }
           })
        });
	})
</script>
</html>
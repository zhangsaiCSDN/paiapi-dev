<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link
	href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css"
	rel="stylesheet">
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.bootcss.com/axios/0.19.0/axios.min.js"></script>
<script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="../../layer/layer.js"></script>

<link rel="stylesheet" href="../../layuiadmin/layui/css/layui.css"
	media="all">
<link rel="stylesheet" href="../../layuiadmin/style/admin.css"
	media="all">
</head>
<body>
	
	<table 
		class="table table-hover table-striped table-bordered table-dark">
		<thead>
			<tr>
				<td>图片id</td>
				<td>拍品id</td>
				<td>拍品名</td>
				<td>图片</td>
				<td>操作</td>
			</tr>
		</thead>
		<tbody id="image">		
		</tbody>
		<tfoot>
			<form id="form" method="post" enctype="multipart/form-data">

				<tr>
					<td>添加</td>
					<td colspan="2">拍品id:<input name="gid" /></td>
					<td>       
						<input id="file" name="file" type="file" multiple="multiple"/></td>
					<td><input id="upload" name="upload" type="button" value="上传"></td>
				</tr>

			</form>
		</tfoot>
	</table>
	
</div>	
	
</body>
<script src="../../../layuiadmin/layui/layui.js"></script>
<script type="text/javascript">
	//获取所有商品类型
	$(function(){
		function find(){
			$.ajax({
				type:"get",
				url:"/images",
				success:function(data){
					$("#image").empty();
					for(var i=0;i<data.length;i++){
						var tr=$("<tr></tr>");
						
						var td1=$("<td></td>");
						var td2=$("<td></td>");
						var td3=$("<td></td>");
						var td4=$("<td></td>");
						var td5=$("<td></td>");
						
						td5.html(data[i].goods.gname);
						
						td1.html(data[i].imgid);
						td2.html(data[i].goods.gid); //外鍵gid

						td3.html( "<img width='100px' src='/admin/goods/goodsImg/"+data[i].img+"'>  "  );
	
						
						var del = $("<button>删除</button>");
						del.click(function(){
							
								var imgid = $(this).parent().parent().children().eq(0).html();

								$.ajax({
										type:"delete",
										url:"/images",
										data:{"imgid":imgid},
										success:function(){
											find();
											alert("删除成功");											
										}
									
									});
							});
						
						td4.append(del);
						tr.append(td1);
						tr.append(td2);
						tr.append(td5);//gname
						tr.append(td3);
						tr.append(td4);
						
						$("#image").append(tr);
					}							
				}
			});
		}
		
		find();
		//显示增加表单
		$("#add").click(function(){	
			$("#addtab").toggle();
		});
		
		//添加拍品
        $("#upload").click(function () {
    
        	var gid=$("form").serialize();//获取表单中的拍品id

           var formData = new FormData($('#form')[0]);//获取表单中的文件
           //ajax请求
           $.ajax({
               url:"/images",//后台的接口地址
               type:"post",//post请求方式
               data:formData,gid,//参数
               cache: false,
               processData: false,
               contentType: false,
               success:function (data) {
                   alert(data);
                   find();
               },error:function () {
                   alert("操作失败~");
               }
           })
        });


	})
</script>
</html>
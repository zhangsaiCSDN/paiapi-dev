<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/axios/0.19.0/axios.min.js"></script>
<script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>
<link rel="stylesheet" href="../../layuiadmin/layui/css/layui.css" media="all">
<link rel="stylesheet" href="../../layuiadmin/style/admin.css" media="all">
<script
	src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>
<body>


<div id="app">
	<button type="button"  class="btn btn-success btn-block"
				data-toggle="modal" data-target="#myModal2">添加</button>  
				

<!--编辑  修改模态框-->
	<div class="container">
		<!-- 模态框 -->
		<div class="modal fade" id="myModal">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<!-- 模态框头部 -->
					<div class="modal-header">
						<h4 class="modal-title">修改图片</h4>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>
					<!-- 模态框主体 -->
					<div class="modal-body">
						<div >
							<label for="pwd">图片id:</label> <input type="text" class="form-control" v-model="u_imgid" disabled="disabled"  />
						</div>
						<div>
							<label for="pwd">拍品id:</label> <input type="text" class="form-control" v-model="u_gid" />
						</div>
						<div>
							<label for="pwd">修改图片:</label><input  class="form-control" ref='photoUdp' name="file" type="file" multiple="multiple"/>
													<button @click='updImg(u_imgid)' id='update' type='button' class='btn btn-warning'>更换图片</button>
						</div>

					</div>
					<!-- 模态框底部 -->
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-dismiss="modal"  @click='update'>提交</button>
					</div>
				</div>
			</div>
		</div>
	</div>
<!--添加  添加模态框-->
	<div class="container">
		<!-- 模态框 -->
		<div class="modal fade" id="myModal2">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<!-- 模态框头部 -->
					<div class="modal-header">
						<h4 class="modal-title">添加图片</h4>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>
					<!-- 模态框主体 -->
					<div class="modal-body">
						<div>
							<label for="pwd">拍品id:</label> <input type="text" class="form-control" v-model="gid" />
						</div>
						<div>
							<label for="pwd">增加图片:</label> <input  class="form-control" ref='photo' name="file" type="file" multiple="multiple"/>
						</div>

					</div>
					<!-- 模态框底部 -->
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-dismiss="modal"  @click='add' >提交</button>
					</div>
				</div>
			</div>
		</div>
	</div>
		
	
	<table class="table table-hover table-striped table-bordered table-dark">
		<tr>
			<th>图片id</th>
			<th>拍品id</th>
			<th>拍品名称</th>
			<th>图片</th>
			<th>操作</th>
		</tr>
		<tr v-for="i in images">
			<td>{{i.imgid}}</td>
			<td>{{i.gid}}</td>
			<td>{{i.goods.gname}}</td>
			<td><img  :src='"goodsImg/"+i.img' width="150px"/></td>
			

			<td>
			<button type="button" class="btn btn-outline-info"
				data-toggle="modal" data-target="#myModal"
				@click='getEdit(i)'>编辑</button>  
	
			<button @click='del(i.imgid)' id='update' type='button' class='btn btn-danger'>删除</button>
			</td>
		</tr>
	</table>
	</div>
</body>
 <script src="../../../layuiadmin/layui/layui.js"></script>  
	<script>
		var vue = new Vue({
			el: "#app",
			data: {
				images: [],
				imgid:'',
				gid:'',
				
				u_imgid:'',
				u_gid:''							

			},
			mounted: function() { //mounted　表示这个 Vue 对象加载成功了
		 		var self = this
				axios.get("http://localhost:8080/images").then(function(response) {
					self.images = response.data; //此时还是字符串
			
				})
			},
			 
			methods: {
				findAll() {
					var self = this;
					axios.get("http://localhost:8080/images").then(function(response) {
						self.images = response.data; //此时还是字符串
					})
				},
				del(imgid) {
					if(!confirm('是否要删除当前数据')){
						return;
	                }
					
					var self = this;
					axios.delete("http://localhost:8080/images?imgid=" + imgid).then(function(response) {
						alert('删除成功');
						self.findAll();
					})
				},
				/* 编辑时的数据回显 */
				getEdit(i){
					this.u_imgid=i.imgid,
					this.u_gid=i.gid				
				},
				/* 修改数据 */
				update() {
					
					var self = this; 
					axios.put("http://localhost:8080/images", {
						
						imgid:this.u_imgid,
						gid:this.u_gid
	
					}).then(function(response) {
						alert('更改成功!');
						self.findAll();
				
					})
				},
				/* 修改图片 */
				updImg(imgid) {
					
		            var formData = new FormData();
		            
		            var photoInput = this.$refs.photoUdp;
					formData.append("photo",photoInput.files[0]);
					formData.append("imgid",imgid);

					
		            var self = this; 
					axios.post("http://localhost:8080/images/updImg", formData).then(function(response) {
						self.findAll();
						alert('修改图片成功!');
					})   
				},
				
				add() {
		            var formData = new FormData();
		            
		            var photoInput = this.$refs.photo;
					formData.append("photo",photoInput.files[0]);
					formData.append("gid",this.gid);

					
		            var self = this; 
					axios.post("http://localhost:8080/images", formData).then(function(response) {
						self.findAll();
						alert('添加成功!');
					})   
				}
			}
			
		});
	</script>
</html>
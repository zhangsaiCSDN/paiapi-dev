<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>竞价历史记录管理</title>
<script src="https://cdn.bootcss.com/axios/0.19.0/axios.min.js"></script>
<script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
  <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css"  media="all">
  <script src="/layuiadmin/layui/layui.all.js"></script>
  <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

	<div id="app">
		<adds></adds>
		<button @click="save" class="btn btn-success btn-sm">添加数据</button>
		<table class="table table-hover table-striped table-bordered table-dark">

			<tr>
				<th>id</th>
				<th>用户名称</th>
				<th>拍品名称</th>
				<th>竞拍金额</th>
				<th>竞拍时间</th>
				<th>操作</th>
			</tr>

			<tr v-for="item in list">
				<th>{{item.phid}}</th>
				<th>{{item.user.uname}}</th>
				<th>{{item.goods.gname}}</th>
				<th>{{item.phmoney}}</th>
				<th>{{item.phtime}}</th>
				<th>
					<button @click="updateUI(item)" class="btn btn-warning btn-sm">修改</button>
					<button @click="del(item.phid)" class="btn btn-danger btn-sm">删除</button>
				</th>
			</tr>
		</table>
		
		<div id="demo7"></div>
	</div>
	
<script>
	var form = layui.form;
	var laypage = layui.laypage;
	form.render();
	
	var vue  = new Vue({
		el:"#app",
		data:{
			list:[],
			page:''
		},
		methods:{
			findAll(){
				var self = this;
				var par = {"p":self.page.p , "size":self.page.size};
				axios.get("http://localhost:8080/phistorys" , {params: par}).then(function(response){
					self.list = response.data.list;
					self.page = response.data;
					
					<!--分页layui -->
					laypage.render({
					    elem: 'demo7',
					    count: response.data.rowCount,
					    curr: response.data.p,
					    limit:response.data.size,
					    	limits:[2,5,10,20],
					    first: '首页',
					    last: '尾页',
					    layout: ['count', 'prev', 'page', 'next', 'limit', 'skip'],
					    jump: function(obj,first){
						    if(!first){
						      var param ={"p":obj.curr,"size":obj.limit};
						      axios.get("http://localhost:8080/phistorys" , {params: param}).then(function(response){
						    		self.list = response.data.list;
									self.page = response.data
						      });
						    }
					    }
					  });
					
				});
			},
			updateUI(item){
				var self = this;
				layer.open({
					type : 2,
					title : "添加竞价记录",
					area : ['650px' , '450px'],
					content : 'updateUI.html',
					  success: function (layero, index) {
		                    // 获取子页面的iframe
		                    var iframe = window['layui-layer-iframe' + index];
		                    // 向子页面的全局函数child传参
		                    iframe.child(item,index);
		                    
		                    //父页面设置一个方法，将其定为window属性，在子页面可以调用
		                    var _tools = {
		                    	    func1: function(){
		                    	      self.findAll();
		                    	    }
		               		 }
					 		 window.tools = _tools;
					  }
				});
			},
			
			save(){
				var self = this;
				layer.open({
					type : 2,
					title : "添加竞价记录",
					area : ['650px' , '450px'],
					content : 'saveUI.html',
					  success: function (layero, index) {
		                    // 获取子页面的iframe
		                    var iframe = window['layui-layer-iframe' + index];
		                    // 向子页面的全局函数child传参
		                    iframe.child(index);
		                    
		                  
		                }
				});
				
			},
			
			del(phid){
				var self = this;
				
				layer.confirm('是否删除？？？', {
					  btn: ['删除','取消'] //按钮
					}, function(){
					  
					  var param ={"phid":phid};
						axios.delete("http://localhost:8080/phistorys" , {params: param}).then(function(){
							self.findAll();
							layer.msg('删除成功！！', {icon: 1});
						});
					}, function(){
						layer.msg('已取消', {icon: 2});
					});
				}
			
		},
		mounted:function(){
			this.findAll();
		}

	});

	

	
</script>
</body>
</html>